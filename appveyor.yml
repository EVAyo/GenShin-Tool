version: 'cvautotrack.{build}'
os: Visual Studio 2017
configuration: Release
platform:
    - x64

environment:
  opencvinc: C:\project\opencv\include
  opencvlib: C:\project\opencv\x64\vc15\staticlib\lib
  opencvURL: https://github.com/GengGode/opencv450Release/releases/download/v1.0/Release.zip
  myProject: C:\project\cvAutoTrack\
  myProjectLib: C:\project\opencv\
skip_tags: true

init:
    - cmake --version
  
install:
    - ps: $env:TIME_STRING=(get-date -UFormat "%Y%m%d%a").ToString()

    # download opencv:
    - mkdir %myProjectLib%
    - appveyor DownloadFile %opencvURL%
    - 7z x ./*.zip -y -o%myProjectLib%
    - rm -f ./*.zip

before_build:
    # test sdl and vcltl path
    #- test -e %sdl%CMakeLists.txt && echo exist || echo %sdl%CMakeLists.txt Not exist && exit 1
    #- test -e %vcltl%VC-LTL" helper for cmake.cmake" && echo exist || echo %vcltl%VC-LTL helper for cmake.cmake Not exist && exit 1
    
    # check file
    #- tail -n 2 %sdl%CMakeLists.txt    
    
build_script:
    - devenv C:\project\cvAutoTrack\cvAutoTrack.sln /Build

after_build:
    # remove unnecessary files
    #- rm -f %sdl%x64/Release/*.exp
    #- rm -f %sdl%x64/Release/*.pdb
    #- rm -f %sdl%x64/Release/SDL2-static.lib
    
    # copy include and source code files
    - mkdir %myProject%x64/build/
    - cp -r %myProject%x64/Release/*.dll %myProject%x64/build/
    
    #- cd %sdl%
    #- set LatestTag=$(git describe --tags `git rev-list --tags --max-count=1`)
    
    - 7z a cvautotrack-%TIME_STRING%.7z %myProject%x64/build/*
    - appveyor PushArtifact cvautotrack-%TIME_STRING%.7z
    
#artifacts:
    #- path: build/Release
    #artifacts path name must be appveyor API
  
deploy:
    - provider: GitHub
      description: 'weekly build cvautotrack' 
      auth_token:
        secure: b7z/bl9MpzzCY+CYah15JF9aJbut5gtIWcpiZOoZpVc41W7NmKOOeB40RO7HiiK/
      draft: false
      tag: cvautotrack-%TIME_STRING%
      on:  
        APPVEYOR_REPO_TAG: false